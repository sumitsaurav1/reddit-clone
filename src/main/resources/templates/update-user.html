<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <meta charset="UTF-8">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter&display=swap" rel="stylesheet">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,1,0"/>
    <title>Update User</title>

    <link rel="stylesheet" href="../static//css/update-user.css">
    <link rel="stylesheet" th:href="@{/css/update-user.css}">
    <script>
<!--        document.addEventListener("DOMContentLoaded", function () {-->
<!--          const passwordField = document.getElementById("password");-->
<!--            if(passwordField.value.length<8){-->
<!--              alert("Passwords length should be greater than or equal to eight !");-->
<!--              event.preventDefault();-->
<!--            }-->
<!--          });-->

document.addEventListener("DOMContentLoaded", function () {
    const passwordField = document.getElementById("password");

    const form = document.querySelector("form");
    form.addEventListener("submit", function (event) {
      if(passwordField.value.length<8){
        alert("Passwords length should be greater than or equal to eight !");
        event.preventDefault();
      }
    });
  });


<!--        function changeLanguage(selectedLanguage) {-->
<!--            // Update the value of the hidden input field with the selected language-->
<!--            document.getElementById("selected-language").value = selectedLanguage;-->
<!--        }-->

        function myFunction(language) {
            console.log(language);
            changeLanguage(language);
        }

        function changeLanguage(lang) {
            const translations = {
                en: {
                    homeLink: 'Home',
                    signUpLinkText: 'Sign Up',
                    loginButtonText: 'Login',
                    pageHeading: 'Welcome to the Website',
                    introText: 'This is the introduction text.',
                    submitButtonText: 'Submit',
                    logoutText: 'Logout',
                    newText: 'New',
                    hotText: 'Hot',
                    topText: 'Top',
                    createPostText: 'Create Post',
                    createCommunityText: 'Create Community',
                    searchBlogText: 'Search for blog posts',
                    writeThoughtText: 'Write your thought',

                    usernameLabel: 'Name',
                    emailLabel: 'Email',
                    passwordLabel: 'Password',
                    nameLabelPlaceholder: 'Enter your name',
                    emailPlaceholder: 'Enter your email',
                    passwordPlaceholder: 'Enter your new password',
                    selectLanguageLabel: 'Select your favorite language',
                    updateText: 'Update',
                    // Add translations in English for other elements,
                },
                hi: {
                    homeLink: 'होम',
                    signUpLinkText: 'साइन अप करें',
                    loginButtonText: 'लॉगिन',
                    pageHeading: 'वेबसाइट में आपका स्वागत है',
                    introText: 'यह परिचय टेक्स्ट है।',
                    submitButtonText: 'प्रस्तुत करें',
                    logoutText: 'लॉग आउट',
                    newText: 'नया',
                    hotText: 'हॉट',
                    topText: 'शीर्ष',
                    createPostText: 'पोस्ट बनाएं',
                    createCommunityText: 'कम्युनिटी बनाएं',
                    searchBlogText: 'ब्लॉग पोस्ट के लिए खोजें',
                    writeThoughtText: 'अपनी विचारना लिखें',

                    usernameLabel: 'नाम',
                    emailLabel: 'ईमेल',
                    passwordLabel: 'पासवर्ड',
                    nameLabelPlaceholder: 'अपना नाम दर्ज करें',
                    emailPlaceholder: 'अपना ईमेल दर्ज करें',
                    passwordPlaceholder: 'अपना नया पासवर्ड दर्ज करें',
                    selectLanguageLabel: 'अपनी पसंदीदा भाषा चुनें',
                    updateText: 'संशोधित करें',
                },
                te: {
                    homeLink: 'హోమ్',
                    signUpLinkText: 'నమోదు చేయండి',
                    loginButtonText: 'లాగిన్',
                    pageHeading: 'వెబ్సైట్‌కు స్వాగతం',
                    introText: 'ఇది పరిచయ టెక్స్ట్ ఉంది.',
                    submitButtonText: 'సమర్పించండి',
                    logoutText: 'లాగ్ అవుట్',
                    newText: 'కొత్తది',
                    hotText: 'హాట్',
                    topText: 'టాప్',
                    createPostText: 'పోస్ట్ సృష్టించు',
                    createCommunityText: 'కమ్యూనిటీ సృష్టించు',
                    searchBlogText: 'బ్లాగు పోస్ట్‌లను వెతకండి',
                    writeThoughtText: 'మీ ఆలోచనను రాయండి',

                    usernameLabel: 'పేరు',
                    emailLabel: 'ఇమెయిల్',
                    passwordLabel: 'పాస్వర్డ్',
                    nameLabelPlaceholder: 'మీ పేరు నమోదు చేయండి',
                    emailPlaceholder: 'మీ ఇమెయిల్ నమోదు చేయండి',
                    passwordPlaceholder: 'మీ కొత్త పాస్వర్డ్ నమోదు చేయండి',
                    selectLanguageLabel: 'మీ ఇష్టమైన భాషను ఎంచుకోండి',
                    updateText: 'నవీకరించు',
                }
            };

            const translatedTexts = translations[lang];

            document.getElementById('home-link').textContent = translatedTexts.homeLink;
           if(document.getElementById('logout')!=null){
                document.getElementById('logout').textContent = translatedTexts.logoutText;
           }
           document.getElementById('search-blog').placeholder = translatedTexts.searchBlogText;


            document.querySelector('label[for="username"]').textContent = translatedTexts.usernameLabel;
            document.querySelector('label[for="email"]').textContent = translatedTexts.emailLabel;
            document.querySelector('label[for="password"]').textContent = translatedTexts.passwordLabel;

            // Update input placeholders
            document.getElementById('username').placeholder = translatedTexts.nameLabelPlaceholder;
            document.getElementById('email').placeholder = translatedTexts.emailPlaceholder;
            document.getElementById('password').placeholder = translatedTexts.passwordPlaceholder;

            // Update select label
            document.getElementById('fav-lang').textContent = translatedTexts.selectLanguageLabel;

            document.getElementById('submit-btn').textContent = translatedTexts.updateText;
            localStorage.setItem('user_language', lang);
        }
    </script>
</head>
<body>

    <div class="nav">
        <div class="nav-item1">
            <div class="logo">
                <img src="https://www.redditinc.com/assets/images/site/reddit-logo.png">
                <strong>reddit</strong>
            </div>
    
            <div class="dropdown">

                <div style="align-items:center;
                        text-align:center;
                        display:flex;
                        border:1px solid #BDC3C7 ;
                        padding:3px 2px; width:190px;
                        justify-content:space-between;
                        cursor:pointer;">
                    <a  th:href="@{/posts}" class="dropbtn" id="home-link">Home </a>
                    <span class="material-symbols-outlined">stat_minus_1</span>
                </div>

                <div class="dropdown-content">
    
                    <form th:action="@{/subreddit}" method="get" class="search-form">
                <span class="material-symbols-outlined">
                    search
                    </span>
                        <input type="text" name="subredditName" placeholder="Search subreddit">
                    </form>

                    <a id="create-community-box" th:href="@{/create-community}"><span class="material-symbols-outlined">add</span> <p>Create Community</p></a>


                    <div class="select-box" th:each="subreddit: ${subredditList}">

                        <div class="option">
                            <img th:if="${ subreddit != null && subreddit.media != null}"   th:src="@{${'/display?id=' + subreddit.media.mediaId}}" alt="Image">
                            <a th:if="${subreddit.name != null}" th:href="@{'/subreddit/r/'+ ${#strings.substring(subreddit.name, 2)}}"
                               th:text="${subreddit.name}">
                            </a>
                            <span class="material-symbols-outlined">star</span>
                        </div>

                    </div>
    
                </div>
            </div>
    
        </div>
        <div class="nav-item2">
            <form th:action="@{/search}" method="get" class="search-form">
                <span class="material-symbols-outlined">search</span>
                <input type="text" name="text" placeholder="Search for blog posts" id="search-blog" >
            </form>
        </div>
    
        <div class="nav-item3">
            <span class="material-symbols-outlined">
                bubble
            </span>
            <span class="material-symbols-outlined">
                chat_bubble
            </span>
    
            <a class="add" th:href="@{/create-post}">
                <span class="material-symbols-outlined">
                add
                </span>
            </a>
            <div class="user-box" sec:authorize="isAuthenticated()">
                <a class="add" th:href="@{/profile/posts}"><span th:if="${user != null}" th:text="${user.username}"></span></a>
               &nbsp;  
             
                <p>Karma:<span th:if="${user != null}" th:text="${user.karma}"></span></p>
    
            </div>
            <div sec:authorize="isAnonymous()" class="auth">
                <a th:href="@{/register}">Sing Up</a>
                <a th:href="@{/login}" id="login-button">Login</a>
            </div>
            <div sec:authorize="isAuthenticated()" >
                <form  th:action="@{/logout}" method="POST">
<!--                    <input id="logout" type="submit" value="Logout" class="logout-button">-->
                    <button id="logout">Logout</button>
                </form>
            </div>
        </div>
    </div>
    

<div class="update-box" >
    <form th:action="@{/updateUser}" method="post" th:object="${user}" enctype="multipart/form-data">
        
        <div class="image-box" th:if="${user != null && user.media != null}">
            <div class="user-image" th:if="${user.media.contentType.startsWith('image/')}">
                <img  th:src="@{${'/display?id=' + user.media.mediaId}}" alt="Image">
            </div>
        </div>
        <div class="image-box" th:unless="${user != null && user.media != null}" >
            <img src="https://www.redditinc.com/assets/images/site/reddit-logo.png">
        </div>

        <label for="username">Name</label>
        <input type="text" id="username" name="username" th:field="*{username}" th:value="${user.username}" required placeholder="Enter your name"><br>
        <label for="email">Email</label>
        <input type="email" id="email" name="email"  required>
        <label for="password">Password</label>
        <input type="password" id="password" name="password"  th:field="*{password}" placeholder="Enter your new password" >
        <input type="file" name="file" aria-describedby="inputGroupFileAddon04" aria-label="Upload" id="fileInput">
        <div id="fileDisplayArea"></div>
        <span id="fav-lang">Select your favorate language</span>
        <select id="language-selector" name="selectedLanguage">
            <option value="en">English</option>
            <option value="hi">हिन्दी</option> <!-- Hindi -->
            <option value="te">తెలుగు</option> <!-- Telugu -->
            <!-- Add more language options as needed -->
        </select>

<!--        <input type="submit" value="UpdateUser">-->
        <button id="submit-btn">UpdateUser</button>
    </form>

</div>
    <div th:if="${user != null}">
        <!-- Render content if the user object is present -->
        <script th:inline="javascript">
            /* Check if the user object is present and then call myFunction */
            var userLanguage = /*[[${user.language}]]*/ null; // Get the user's language
            if (userLanguage !== null) {
                myFunction(userLanguage);
            }
        </script>
    </div>
    <div th:if="${user == null}">
        <!-- Render content if the user object is present -->
        <script th:inline="javascript">
            /* Check if the user object is present and then call myFunction */

            const storedLang = localStorage.getItem('user_language');
            if (storedLang !== null) {
                myFunction(storedLang);
            }
        </script>

    </div>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const fileInput = document.getElementById('fileInput');
            const fileDisplayArea = document.getElementById('fileDisplayArea');

            fileInput.addEventListener('change', function() {
                const file = fileInput.files[0]; // Get the selected file

                if (file) {
                    const reader = new FileReader();

                    reader.onload = function(e) {
                        if (file.type.startsWith('image')) {
                            // Display images using an <img> tag
                            fileDisplayArea.innerHTML = `<img src="${e.target.result}" alt="Uploaded Image">`;
                        } else if (file.type.startsWith('video')) {
                            // Display videos using a <video> tag
                            fileDisplayArea.innerHTML = `<video controls><source src="${e.target.result}" type="${file.type}"></video>`;
                        } else {
                            // Display other file types as a download link
                            fileDisplayArea.innerHTML = `<a href="${e.target.result}" download="${file.name}">Download ${file.name}</a>`;
                        }
                    };

                    reader.readAsDataURL(file); // Read the file as a data URL
                } else {
                    // If no file is selected, clear the display area
                    fileDisplayArea.innerHTML = '';
                }
            });
        });
    </script>
</body>
</html>
